<!DOCTYPE html>
<html>

<head>
    <title>PayFlowPro Admin Login</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background: #0b0f14;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Segoe UI;
        }

        .box {
            background: #141a22;
            padding: 40px;
            border-radius: 12px;
            width: 320px;
            box-shadow: 0 0 40px rgba(0, 255, 180, .2);
        }

        h2 {
            color: #00ffc3;
            text-align: center;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 12px 0;
            border: none;
            border-radius: 8px;
            background: #0f151d;
            color: white;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #00ffc3;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .error {
            color: red;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <div class="box">
        <h2>PayFlowPro Admin</h2>
        <input type="email" id="email" placeholder="Admin Email">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
        <p class="error" id="error"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyADjMc3Jwsjlg_ajo282ZtM5jvDUuGdoRk",
            authDomain: "payflowpro-6e62d.firebaseapp.com",
            databaseURL: "https://payflowpro-6e62d-default-rtdb.firebaseio.com",
            projectId: "payflowpro-6e62d",
            storageBucket: "payflowpro-6e62d.firebasestorage.app",
            messagingSenderId: "69298740438",
            appId: "1:69298740438:web:18fd85e982e083e1543d77"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const SUPER_ADMIN_EMAIL = "Payflow@gmail.com";
        const SUPER_ADMIN_PASS = "Payflowpro";

        window.login = async () => {
            const input = document.getElementById("email").value;
            const p = document.getElementById("password").value;
            const errorEl = document.getElementById("error");

            errorEl.innerText = "Checking...";

            // 1. Check Hardcoded Super Admin
            if (input === SUPER_ADMIN_EMAIL && p === SUPER_ADMIN_PASS) {
                localStorage.setItem("admin", "true");
                localStorage.setItem("role", "super_admin");
                location.href = "dashboard.html";
                return;
            }

            // 2. Check Firebase Admins
            try {
                const snapshot = await get(ref(db, 'admins'));
                let found = false;

                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        const admin = child.val();
                        // Check if input matches Email OR Admin ID
                        if ((admin.email === input || admin.adminId === input) && admin.password === p) {
                            localStorage.setItem("admin", "true");
                            localStorage.setItem("role", admin.role || 'branch_admin');
                            localStorage.setItem("branch", admin.branch || '');
                            localStorage.setItem("name", admin.name || 'Admin');

                            location.href = "dashboard.html";
                            found = true;
                        }
                    });
                }

                if (!found) {
                    errorEl.innerText = "Invalid login credentials";
                }
            } catch (err) {
                errorEl.innerText = "Login error: " + err.message;
                console.error(err);
            }
        }
    </script>

</body>

</html>